<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Product</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
      <a class="navbar-brand" href="Website.html">Simple Shop</a>
      <div id="user-area" class="ms-auto"></div>
    </div>
  </nav>
  <main class="container product-page my-4">
    <a href="Website.html" class="btn btn-link mb-3">‚Üê Back to products</a>
    <div id="product-detail"></div>
  </main>

  <!-- Edit Modal -->
  <div class="modal fade" id="editModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Edit Product</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <form id="edit-form">
          <div class="modal-body">
            <div class="mb-2">
              <label class="form-label">Product name</label>
              <input id="edit-name" class="form-control" required>
            </div>
            <div class="mb-2">
              <label class="form-label">Price (USD)</label>
              <input id="edit-price" type="number" step="0.01" class="form-control" required>
            </div>
            <div class="mb-2">
              <label class="form-label">Image URL</label>
              <input id="edit-image" class="form-control" placeholder="https://... (optional)">
            </div>
            <div class="mb-2">
              <label class="form-label">Description</label>
              <textarea id="edit-description" class="form-control" rows="3"></textarea>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary">Save changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="app.js"></script>
  <script>
    alert('Product page loaded');
    
    function qs(name) {
      const params = new URLSearchParams(location.search);
      return params.get(name);
    }

    const id = qs('id');
    console.log('Product ID from URL:', id);
    
    if (!id) {
      alert('No product ID in URL');
      document.getElementById('product-detail').innerHTML = '<p>No product found.</p>';
    } else {
      alert('Loading product ID: ' + id);
      
      const products = JSON.parse(localStorage.getItem('products') || '[]');
      const product = products.find(p => p.id === id);
      
      if (!product) {
        alert('Product not found in localStorage');
        document.getElementById('product-detail').innerHTML = '<p>Product not found.</p>';
      } else {
        alert('Found product: ' + product.name);
        renderProduct(product);
        
        document.getElementById('edit-form').addEventListener('submit', (e) => {
          e.preventDefault();
          console.log('Form submitted');
          const products = JSON.parse(localStorage.getItem('products') || '[]');
          const idx = products.findIndex(p => p.id === id);
          if (idx !== -1) {
            products[idx].name = document.getElementById('edit-name').value;
            products[idx].price = document.getElementById('edit-price').value;
            products[idx].image = document.getElementById('edit-image').value;
            products[idx].description = document.getElementById('edit-description').value;
            localStorage.setItem('products', JSON.stringify(products));
            bootstrap.Modal.getInstance(document.getElementById('editModal')).hide();
            renderProduct(products[idx]);
            alert('Product updated!');
          }
        });
      }
    }
    
    function renderProduct(product) {
      const container = document.getElementById('product-detail');
      container.innerHTML = `
        <div class="product-full">
          ${product.image ? `<img src="${product.image}" alt="${product.name}">` : ''}
          <div class="product-info">
            <h2>${product.name}</h2>
            <p class="price">$${Number(product.price).toFixed(2)}</p>
            <p class="desc">${product.description || ''}</p>
            <div class="mt-3 d-flex gap-2">
              <button id="edit-btn" class="btn btn-primary" type="button">Edit Product</button>
              <button id="delete-btn" class="btn btn-danger" type="button">Delete</button>
            </div>
          </div>
        </div>
      `;
      
      document.getElementById('edit-btn').addEventListener('click', (e) => {
        e.preventDefault();
        console.log('Edit button clicked');
        document.getElementById('edit-name').value = product.name;
        document.getElementById('edit-price').value = product.price;
        document.getElementById('edit-image').value = product.image || '';
        document.getElementById('edit-description').value = product.description || '';
        new bootstrap.Modal(document.getElementById('editModal')).show();
      });
      
      document.getElementById('delete-btn').addEventListener('click', (e) => {
        e.preventDefault();
        if (confirm('Delete this product?')) {
          const products = JSON.parse(localStorage.getItem('products') || '[]');
          const idx = products.findIndex(p => p.id === id);
          if (idx !== -1) {
            products.splice(idx, 1);
            localStorage.setItem('products', JSON.stringify(products));
            location.href = 'Website.html';
          }
        }
      });
    }
  </script>
</body>
</html>